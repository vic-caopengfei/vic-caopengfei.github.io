---
title: Spring 事务详解
author: vic
date: 2022-02-21 00:34:00 +0800
categories: [Blogging, Java]
tags: [favicon]
typora-root-url: ..
---

# Spring 事务详解

## 1. 什么是事务

### 定义

数据库事务处理的一系列操作。这些操作要么完全完成，要么完全无效。事务管理是面向 rdbms 的企业应用中保证数据完整性和一致性的重要组成部分

### 事务的特性

- 原子性（Atomicity） 原子性是指事务是一个不可分割的工作单位，事务中的操作要么全部成功，要么全部失败。比如在同一个事务中的 SQL 语句，**要么全部执行成功，要么全部执行失败**
- 一致性（Consistency） 官网上事务一致性的概念是：事务必须使数据库从一个一致性状态变换到另外一个一致性状态。换一种方式理解就是：事务按照预期生效，**数据的状态是预期的状态**。
- 隔离性（Isolation） 事务的隔离性是多个用户并发访问数据库时，数据库为每一个用户开启的事务，不能被其他事务的操作数据所干扰，多个并发事务之间要相互**隔离**
- 持久性（Durability） 持久性是指一个事务一旦被提交，它对数据库中数据的改变就是永久性的，接下来即使数据库发生故障也不应该对其有任何影响。

### 数据库事务隔离界别(Isolation)

数据库的隔离级别分为四种`read uncommitted`  `read committed`  `repeatable read` `serializeble`

依次 隔离级别越来越高，对数据库性能影响越来越大。

> read uncommitted

顾名思义 读未提交，在一个数据库session中，可以读到另一个线程session操作了数据库但是没有commit 结果，这种就会造成***脏读***

![](/assets/img/post_image/up-e9fd93cbac87c7e0706368f261d4d75d956.webp)

> read committed

读已提交，在一个数据库session中，可以读到另一个线程已经提交的数据，这样虽然避免了脏读，但是还是不够安全，如果在一个线程中 重复查询同一条数据多次，在这期间发生了commit 就会导致 多次查询的结果不一致，这在正常业务中也是有问题 这个我们称之为***不可重复读***

![](/assets/img/post_image/up-676d2e771c4be9958f86ad61c726b01f816.webp)

> repeatable read

可重复读，可以解决read committed 不可重复读的问题，**这也是目前大部分DBMS默认的事务隔离界别** 能保证在一个线程中多次读取的一致性；在一些严格的场景中 还是会存在一些问题  比如此级别的事务正在执行时，另一个事务成功的插入了某条数据，但因为它每次查询的结果都是一样的，所以会导致查询不到这条数据，自己重复插入时又失败（因为唯一约束的原因）。**明明在事务中查询不到这条信息，但自己就是插入不进去，这就叫幻读 （Phantom Read）。**

![](/assets/img/post_image/up-c960607f80531b464ca205ee63ef18bcd73.webp)

## Spring 对事务的支持
## Spring 控制事务的方式
















